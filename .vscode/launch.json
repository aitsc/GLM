{
    "configurations": [
        {
            "name": "Python: Current File",
            "type": "python",
            "request": "launch",
            "program": "${file}",
            "console": "integratedTerminal",
            // "cwd": "${fileDirname}",
            "justMyCode": false,
        },
        {
            "name": "torch.distributed",
            "type": "python",
            "request": "launch",
            "program": "~/anaconda3/envs/GLM/lib/python3.8/site-packages/torch/distributed/launch.py",
            "console": "integratedTerminal",
            "args": [
                "--nproc_per_node=1", // 常调参数
                "--nnodes=1",
                "--node_rank=0",
                "--master_addr=localhost",
                "--master_port=12367",
                // 微调
                // "finetune_glm.py",
                // "--custom_model=model_blocklm_base",
                // "--custom_task=rte",
                // "--custom_script=finetune_superglue",
                // 预训练
                "pretrain_glm.py",
                "--custom_model_pre=block_tiny6", // block_tiny6 block_base
                "--custom_script=pretrain_nvidia",
            ],
            "env": {"CUDA_VISIBLE_DEVICES":"5"},
            "justMyCode": false,
        },
        {
            "name": "deepspeed",
            "type": "python",
            "request": "launch",
            "program": "~/anaconda3/envs/GLM/bin/deepspeed",
            "console": "integratedTerminal",
            "args": [
                "--master_port=12367",
                "--include=localhost:6", // 常调参数
                "--hostfile=",
                // 预训练
                "pretrain_glm.py",
                "--custom_model_pre=block_base",
                "--custom_script=pretrain_nvidia",
                // 微调
                // "finetune_glm.py",
                // "--custom_model=model_blocklm_base",
                // "--custom_task=copa",
                // "--custom_script=finetune_superglue",
                "--deepspeed",
            ],
            "env": {
                "NCCL_DEBUG":"info",
                "NCCL_IB_DISABLE":"0",
                "NCCL_NET_GDR_LEVEL":"2",
            },
            "justMyCode": false,
        },
        {
            "name": "单机单卡",
            "type": "python",
            "request": "launch",
            "console": "integratedTerminal",
            // "program": "finetune_glm.py",
            "program": "pretrain_glm.py",
            // "program": "tsc/ac_模型加载和保存.py",
            "args": [
                // 微调
                "--custom_model=model_blocklm_base",
                "--custom_task=rte",
                "--custom_script=finetune_superglue",
                // 预训练
                "--custom_model_pre=block_base",
                "--custom_script=pretrain_nvidia",
            ],
            "env": {"CUDA_VISIBLE_DEVICES":"6"},
            "justMyCode": false,
        },
        {
            "name": "ds-tune",
            "type": "python",
            "request": "launch",
            "program": "~/anaconda3/envs/GLM/bin/deepspeed", //
            "console": "integratedTerminal",
            "args": [
                "--master_port=12368",
                "--include=localhost:5", //
                "finetune_glm.py",
                // deepspeed
                "--deepspeed",
                "--deepspeed_config=config/config_block_tiny6.json", // 注意其中的 batch size
                "--experiment-name=tiny6-copa", //
                "--checkpoint-activations",
                "--model-parallel-size=1",
                "--finetune",
                "--cloze-eval",
                "--data-dir=data/english_data/superglue/COPA",
                // other
                "--save=data/checkpoints/finetune",  //
                "--num-workers=0",
                "--fp16",
                "--overwrite",
                // "--no-load-optim",
                // "--no-load-lr-scheduler",
                // MODEL_ARGS
                "--block-lm",
                "--num-layers=6",
                "--hidden-size=768",
                "--num-attention-heads=12",
                "--max-position-embeddings=512",
                "--tokenizer-model-type=bert-base-uncased",
                "--tokenizer-type=BertWordPieceTokenizer",
                "--load-pretrained=data/checkpoints/pretrain/block_tiny6/blocklm-blank07-31-07-36", //
                // TRAIN_ARGS
                "--task=COPA", //
                "--lr-decay-style=linear",
                "--warmup=0.1",
                "--weight-decay=1.0e-1",
                "--pattern-id=0",
                "--seq-length=256",  //
                "--eval-batch-size=16",
                "--save-epoch=10000",
                "--batch-size=16",
                "--lr=1e-5",
                // COMMON_ARGS
                "--save-interval=10000",
                "--log-interval=50",
                "--eval-interval=1000",
                "--eval-iters=100",
                "--epochs=1000",
                "--no-lazy-loader",
            ],
            "env": {
                "NCCL_DEBUG":"info",
                "NCCL_IB_DISABLE":"0",
                "NCCL_NET_GDR_LEVEL":"2",
            },
            "justMyCode": false,
        },
    ]
}